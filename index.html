<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ™ºæ…§è¯çµ¡ç°¿ v20.9ï¼ˆè¿”å›ç·¨è¼¯ï¼‹é€±æ¬¡å¯å¡«å¯«ï¼‰</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    :root{
      --primary-color:#2b7de9;
      --page-bg:#ffffff;
      --card-bg:#ffffff;
      --text-color-primary:#000000;
      --card-border:rgba(0,0,0,.12);
      --shadow-color:rgba(0,0,0,.08);
      --item-font-size:1.9em;
      --control-border-radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      font-family:'Microsoft JhengHei','Noto Sans TC',sans-serif;
      color:var(--text-color-primary);
      background:var(--page-bg);
      padding:30px;
      display:flex;align-items:center;justify-content:center;
    }
    .container{max-width:1320px;width:100%}
    .main-header{text-align:center;margin-bottom:20px}
    .main-title{
      font-family:'ZCOOL KuaiLe','Microsoft JhengHei','Noto Sans TC',sans-serif;
      font-size:3em;font-weight:900;
    }
    .card{
      background:var(--card-bg);
      border-radius:24px;
      border:1px solid var(--card-border);
      box-shadow:0 10px 30px var(--shadow-color);
      padding:28px;
      display:flex;
      flex-direction:column;
      min-height:680px;
      max-height:80vh;
    }

    /* æ—¥æœŸ + é€±æ¬¡åˆ— */
    .card-header{
      display:flex;flex-wrap:wrap;gap:12px;
      justify-content:center;align-items:center;
      margin-bottom:14px;padding-bottom:12px;border-bottom:1px solid var(--card-border)
    }
    .nav-date-group{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .nav-date-group button{padding:10px 16px;font-size:1.05em}
    #date-selector{background:none;border:none;font-size:2.2em;font-weight:800;cursor:pointer}
    #week-display{font-size:1.1em;color:#555}
    .weekno-wrap{display:flex;align-items:center;gap:8px;margin-left:8px}
    .weekno-wrap label{font-weight:700;color:#333}
    #weekno-input{
      width:120px;padding:8px 10px;border-radius:10px;
      border:1px solid rgba(0,0,0,.15); font-size:1em;
    }
    #weekno-input:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 3px rgba(43,125,233,.15)}

    /* æ¸…å–® */
    .homework-list{
      list-style:none;padding:0;margin:0;
      display:flex;flex-direction:column;
      gap:6px; /* é–“è·å°ä¸€äº› */
      flex-grow:1;overflow:auto;padding:8px;margin:0 -8px;
    }
    .homework-item{
      display:flex;align-items:flex-start;gap:8px;
      font-size:var(--item-font-size);
      border-radius:var(--control-border-radius);
      padding:10px 12px;
      transition:background-color .2s ease;
      border:1px dashed transparent;
    }
    .homework-item:hover{background-color:rgba(0,0,0,.03)}
    .item-index{color:#555;font-weight:700;margin-top:2px}
    .item-content{flex:1;white-space:pre-wrap;outline:none}
    .delete-item-btn{opacity:0;background:none;border:none;font-size:1.2em;cursor:pointer;color:#777}
    .homework-item:hover .delete-item-btn{opacity:1}

    /* æ–°å¢è¼¸å…¥åˆ— */
    #homework-input-area{
      display:flex;gap:8px;background:rgba(0,0,0,.05);
      border-radius:var(--control-border-radius);
      padding:10px;border:1px solid rgba(0,0,0,.08);
      margin-top:14px;
    }
    #new-homework-input{
      flex:1;padding:10px 12px;font-size:1.2em;
      border-radius:10px;border:1px solid rgba(0,0,0,.15);
    }
    #new-homework-input:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 3px rgba(43,125,233,.2)}
    .add-btn{background:var(--primary-color);color:#fff;border:none;border-radius:10px;padding:10px 14px;cursor:pointer}

    /* æŒ‰éˆ•åˆ— */
    .footer-buttons{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap:10px;margin-top:16px;
    }
    button{border:none;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
    .btn-primary{background:var(--primary-color);color:#fff}
    .btn-secondary{background:rgba(0,0,0,.05);border:1px solid rgba(0,0,0,.12)}
    .font-slider-container{display:flex;align-items:center;gap:10px;background:rgba(0,0,0,.05);padding:8px 10px;border-radius:10px}
    .color-tools{display:flex;gap:10px;justify-content:center;align-items:center}
    .color-tools select,.color-tools input[type=color]{padding:8px 10px;border-radius:10px;border:1px solid rgba(0,0,0,.12)}

    /* ç›´æ›¸æ¨¡å¼ */
    .vertical-mode{flex-direction:row-reverse;align-items:flex-start;overflow-x:auto;overflow-y:hidden;gap:16px}
    .vertical-mode .homework-item{flex-direction:column;min-width:110px;min-height:420px;align-items:stretch;padding:14px}
    .vertical-mode .item-content{writing-mode:vertical-rl;text-align:right}
    .vertical-mode .horizontal-in-vertical{writing-mode:horizontal-tb;display:inline-block}

    /* å±•ç¤ºæ¨¡å¼ï¼šéš±è—éƒ¨åˆ†æ§åˆ¶ã€æ”¾å¤§å­—ç´š */
    .presentation-mode #homework-input-area,
    .presentation-mode .footer-buttons{display:none}
    .presentation-mode .homework-item{background:transparent}
    .presentation-mode .card{max-height:none;min-height:auto}
    .presentation-mode :root{--item-font-size:2.2em}

    /* ç¯„æœ¬è¦–çª— */
    #template-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.3);align-items:center;justify-content:center;z-index:10}
    #template-modal.visible{display:flex}
    .template-card{background:#fff;padding:24px;border-radius:14px;width:90%;max-width:800px}
    .category-tabs{display:flex;gap:8px;margin-bottom:10px}
    .tab-btn{padding:8px 12px;border-radius:8px;border:1px solid rgba(0,0,0,.12);cursor:pointer}
    .tab-btn.active{background:var(--primary-color);color:#fff}
    .templates-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px;max-height:50vh;overflow:auto}
    .template-item{padding:10px;border:1px solid rgba(0,0,0,.1);border-radius:10px;cursor:pointer}
    .template-item:hover{background:var(--primary-color);color:#fff}
  </style>
</head>
<body>
  <div class="container">
    <div class="main-header"><h1 class="main-title">æ™ºæ…§è¯çµ¡ç°¿</h1></div>

    <div class="card" id="main-card">
      <div class="card-header">
        <div class="nav-date-group">
          <button id="prev-day-btn" class="btn-secondary">â—€ ä¸Šä¸€æ—¥</button>
          <input type="date" id="date-selector" aria-label="é¸æ“‡æ—¥æœŸ">
          <button id="next-day-btn" class="btn-secondary">ä¸‹ä¸€æ—¥ â–¶</button>
          <div id="week-display" aria-live="polite"></div>
          <div class="weekno-wrap">
            <label for="weekno-input">é€±æ¬¡</label>
            <input type="text" id="weekno-input" placeholder="ä¾‹å¦‚ï¼šç¬¬ 8 é€±" inputmode="text">
          </div>
        </div>
      </div>

      <ul class="homework-list" id="homework-list" aria-label="è¯çµ¡äº‹é …æ¸…å–®"></ul>

      <div id="homework-input-area">
        <input type="text" id="new-homework-input" placeholder="æ–°å¢äº‹é …..." aria-label="æ–°å¢äº‹é …">
        <button id="add-item-btn" class="add-btn" aria-label="åŠ å…¥äº‹é …">â•</button>
        <button id="show-template-btn" class="btn-secondary" title="å¾ç¯„æœ¬åŠ å…¥" aria-label="å¾ç¯„æœ¬åŠ å…¥">ğŸª„ ç¯„æœ¬</button>
      </div>
    </div>

    <div class="footer-buttons">
      <button id="toggle-vertical-btn" class="btn-secondary" aria-pressed="false">åˆ‡æ›ç›´æ›¸</button>
      <div class="font-slider-container">
        <label for="font-size-slider">å­—ç´š</label>
        <input type="range" id="font-size-slider" min="1.2" max="3.0" step="0.1" value="1.9" aria-label="å­—ç´šå¤§å°">
      </div>
      <div class="color-tools">
        <select id="color-picker" aria-label="å¿«é€Ÿå­—è‰²">
          <option value="">å­—è‰²</option>
          <option value="#000000">é»‘è‰²</option>
          <option value="#d92c2c">ç´…è‰²</option>
          <option value="#1a73e8">è—è‰²</option>
          <option value="#188038">ç¶ è‰²</option>
          <option value="#e37400">æ©™è‰²</option>
          <option value="#6f42c1">ç´«è‰²</option>
        </select>
        <input type="color" id="color-custom" value="#000000" aria-label="è‡ªè¨‚å­—è‰²">
      </div>
      <button id="copy-text-btn" class="btn-secondary">è¤‡è£½æ–‡å­—</button>
      <button id="copy-prev-btn" class="btn-secondary">è¤‡è£½å‰æ—¥</button>
      <button id="export-png-btn" class="btn-primary">åŒ¯å‡ºåœ–ç‰‡ï¼ˆå¡ç‰‡ï¼‰</button>
      <button id="export-fullpng-btn" class="btn-secondary">åŒ¯å‡ºåœ–ç‰‡ï¼ˆæ•´é ï¼‰</button>
      <button id="toggle-presentation-btn" class="btn-secondary">å…¨è¢å¹•å±•ç¤º</button>
    </div>
  </div>

  <div id="template-modal">
    <div class="template-card">
      <h2>é¸æ“‡ä½œæ¥­ç¯„æœ¬</h2>
      <div id="category-tabs" class="category-tabs"></div>
      <div id="templates-grid" class="templates-grid"></div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded',()=>{
      const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
      const today=new Date(),pad=n=>String(n).padStart(2,'0');
      let currentDate=`${today.getFullYear()}-${pad(today.getMonth()+1)}-${pad(today.getDate())}`;
      // å…¼å®¹ï¼šå¯èƒ½æ˜¯ {items,weekno} æˆ– Array
      let allData = {};
      try{ allData = JSON.parse(localStorage.getItem('ultraContactBook_v20_final')||'{}') || {}; }catch(e){ allData = {}; }

      let isVertical=false;
      let isPresentation=false;

      const dateSelector=$('#date-selector');
      const weekDisplay=$('#week-display');
      const weeknoInput=$('#weekno-input');
      const list=$('#homework-list');
      const input=$('#new-homework-input');
      const prevBtn=$('#prev-day-btn');
      const nextBtn=$('#next-day-btn');
      const presentationBtn=$('#toggle-presentation-btn');

      const templates={
        "åœ‹èªæ–‡":["åœ‹ç¿’ L__","åœ‹èªç¿’ä½œ p.__-__","ç”²æœ¬ p.__-__","ç”Ÿå­—æœ¬ L__","èªè©æœ¬ L__","é»˜æ›¸ L__","æ—¥è¨˜"],
        "æ•¸å­¸":["æ•¸ç¿’ p.__-__","æ•¸ç·´ ç¬¬__å›","æ‡‰ç”¨é¡Œ x__"],
        "è‹±èª":["è‹±ç¿’ U__","è‹±è½","å–®å­— U__ å¯«__é","èª²æ–‡æœ—è®€ U__"],
        "é€šç”¨":["è€ƒå·è¨‚ç°½","é ç¿’ L__","å¸¶__","è¦ªå­å…±è®€","é‹å‹•30åˆ†é˜"]
      };

      /* --------- è³‡æ–™æ¨¡å‹å·¥å…· --------- */
      const ensureObjForDate = (d)=>{
        const v = allData[d];
        if (Array.isArray(v)) { // èˆŠæ ¼å¼
          allData[d] = { items: v.slice(), weekno: "" };
        } else if (!v || typeof v!=='object') {
          allData[d] = { items: [], weekno: "" };
        } else {
          if (!Array.isArray(v.items)) v.items = [];
          if (typeof v.weekno !== 'string') v.weekno = '';
        }
        return allData[d];
      };
      const getRecord = (d)=>ensureObjForDate(d);
      const getItems = ()=>$$('.item-content').map(e=>e.textContent.trim()).filter(Boolean);
      const getWeekno = ()=>weeknoInput.value.trim();

      const save = ()=>{
        const rec = ensureObjForDate(currentDate);
        rec.items = getItems();
        rec.weekno = getWeekno();
        localStorage.setItem('ultraContactBook_v20_final', JSON.stringify(allData));
      };

      /* --------- æ—¥æœŸå·¥å…· --------- */
      const fmt=d=>`${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
      const prevDate=s=>{let[y,m,dd]=s.split('-').map(Number);let d=new Date(y,m-1,dd);d.setDate(d.getDate()-1);return fmt(d);};
      const nextDate=s=>{let[y,m,dd]=s.split('-').map(Number);let d=new Date(y,m-1,dd);d.setDate(d.getDate()+1);return fmt(d);};
      const updateDate=s=>{let d=new Date(s+'T00:00');let w=['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'][d.getDay()];weekDisplay.textContent=`æ˜ŸæœŸ${w}`;dateSelector.value=s;};

      /* --------- Render --------- */
      const renderList=(arr)=>{
        list.innerHTML='';
        if(!arr||arr.length===0){list.innerHTML=`<p style="text-align:center;color:#666;">é»æ“Šä¸‹æ–¹è¼¸å…¥æ¡†æ–°å¢ä»Šæ—¥äº‹é …</p>`;return;}
        arr.forEach((t,i)=>{
          const li=document.createElement('li');
          li.className='homework-item';
          li.innerHTML=`<span class="item-index">${i+1}.</span><span class="item-content" contenteditable="true">${t}</span><button class="delete-item-btn" title="åˆªé™¤">Ã—</button>`;
          list.appendChild(li);
        });
      };
      const loadDate=(d)=>{
        const rec = getRecord(d);
        renderList(rec.items);
        weeknoInput.value = rec.weekno || '';
      };

      /* --------- åˆå§‹åŒ– --------- */
      updateDate(currentDate);
      loadDate(currentDate);

      /* --------- æ–°å¢é …ç›® --------- */
      const add=(t)=>{
        if(!t.trim())return;
        const arr=getItems();arr.push(t.trim());
        renderList(arr); save(); input.value='';
      };
      $('#add-item-btn').onclick=()=>add(input.value);
      input.addEventListener('keydown',e=>{
        if(e.key==='Enter' && !e.isComposing){
          // æ”¯æ´åœ¨é …ç›®å…§ Enter æ›è¡Œï¼šæ­¤è™•æ˜¯æ–°å¢è¼¸å…¥æ¡†ï¼Œä»æ¡æ–°å¢ä¸€ç­†
          e.preventDefault(); add(input.value);
        }
      });

      /* --------- é …ç›®å…§ Enter å…è¨±æ›è¡Œ --------- */
      list.addEventListener('keydown',e=>{
        if(e.target.classList.contains('item-content')){
          if(e.key==='Enter' && !e.shiftKey){ // Enter = æ›è¡Œï¼ˆä¸é€å‡ºï¼‰
            e.preventDefault();
            document.execCommand('insertLineBreak');
          }
        }
      });

      /* --------- åˆªé™¤/ç·¨è¼¯å„²å­˜ --------- */
      list.onclick=e=>{
        if(e.target.classList.contains('delete-item-btn')){
          const idx=$$('.delete-item-btn').indexOf(e.target);
          const arr=getItems();arr.splice(idx,1);
          renderList(arr); save();
        }
      };
      list.addEventListener('focusout',e=>{ if(e.target.classList.contains('item-content')) save(); });

      /* --------- æ—¥æœŸåˆ‡æ›ï¼ˆæŒ‰éˆ•èˆ‡é¸æ“‡å™¨ï¼‰ --------- */
      dateSelector.onchange=e=>{ save(); currentDate=e.target.value; updateDate(currentDate); loadDate(currentDate); };
      prevBtn.onclick=()=>{ save(); currentDate=prevDate(currentDate); updateDate(currentDate); loadDate(currentDate); };
      nextBtn.onclick=()=>{ save(); currentDate=nextDate(currentDate); updateDate(currentDate); loadDate(currentDate); };

      /* --------- é€±æ¬¡æ›´æ–° --------- */
      weeknoInput.addEventListener('input', ()=>save());

      /* --------- å­—ç´šèˆ‡ç›´æ›¸ --------- */
      $('#font-size-slider').oninput=e=>document.documentElement.style.setProperty('--item-font-size',`${e.target.value}em`);
      $('#toggle-vertical-btn').onclick=()=>{
        isVertical=!isVertical;
        list.classList.toggle('vertical-mode',isVertical);
        $('#toggle-vertical-btn').setAttribute('aria-pressed', String(isVertical));
        $('#toggle-vertical-btn').textContent = isVertical ? 'åˆ‡æ›æ©«æ›¸' : 'åˆ‡æ›ç›´æ›¸';
      };

      /* --------- å±€éƒ¨å­—è‰² --------- */
      const applyColor=c=>{if(!c)return;document.execCommand('styleWithCSS',false,true);document.execCommand('foreColor',false,c); save();};
      $('#color-picker').onchange=()=>{applyColor($('#color-picker').value);$('#color-picker').value='';};
      $('#color-custom').oninput=()=>applyColor($('#color-custom').value);

      /* --------- è¤‡è£½æ–‡å­—ï¼ˆå«é€±æ¬¡ï¼‰ --------- */
      $('#copy-text-btn').onclick=async()=>{
        const d=new Date(dateSelector.value+'T00:00');
        const w=['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'][d.getDay()];
        const wk = getWeekno();
        const header = `${dateSelector.value.replace(/-/g,'/')}ï¼ˆæ˜ŸæœŸ${w}${wk?`ï¼Œ${wk}`:''}ï¼‰`;
        const text = header + '\n' + getItems().map((t,i)=>`${i+1}. ${t}`).join('\n');
        try{ await navigator.clipboard.writeText(text); alert('å·²è¤‡è£½æ–‡å­—'); } catch{ prompt('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ï¼š', text); }
      };

      /* --------- è¤‡è£½å‰æ—¥ --------- */
      const findPrevDateWithData = (d,limit=60)=>{
        let cur=d; for(let i=0;i<limit;i++){ cur=prevDate(cur); const rec=allData[cur]; const items = Array.isArray(rec)?rec:(rec?.items||[]);
          if(items.length) return cur;
        }
        return null;
      };
      $('#copy-prev-btn').onclick=()=>{
        const p=findPrevDateWithData(currentDate,60);
        if(!p){ alert('æ‰¾ä¸åˆ°å‰æ—¥çš„è¯çµ¡äº‹é …ï¼ˆæœ€è¿‘ 60 å¤©éƒ½æ²’æœ‰è³‡æ–™ï¼‰ã€‚'); return; }
        const prevRec = getRecord(p);
        const prevItems = prevRec.items.slice();
        if(prevItems.length===0){ alert(`${p} æ²’æœ‰é …ç›®å¯è¤‡è£½ã€‚`); return; }
        const replace = confirm(`æ‰¾åˆ° ${p} çš„ ${prevItems.length} é …ã€‚\n\næŒ‰ã€Œç¢ºå®šã€â†’ è¦†è“‹ä»Šå¤©\næŒ‰ã€Œå–æ¶ˆã€â†’ è¿½åŠ åˆ°ä»Šå¤©å¾Œé¢`);
        const result = replace ? prevItems : [...getItems(), ...prevItems];
        renderList(result); save();
        alert(replace ? 'å·²è¦†è“‹ä»Šæ—¥é …ç›®ã€‚' : 'å·²æŠŠå‰æ—¥é …ç›®è¿½åŠ åˆ°ä»Šå¤©ã€‚');
      };

      /* --------- åŒ¯å‡ºåœ–ç‰‡ï¼ˆå¡ç‰‡ / æ•´é ï¼Œå­—è‰²å¼·åˆ¶é»‘ + å¸¶é€±æ¬¡ï¼‰ --------- */
      const exportImage=async(node,name)=>{
        const bar=$('#homework-input-area'); const prev=bar.style.display; bar.style.display='none';
        try{
          const canvas=await html2canvas(node,{scale:2,useCORS:true,backgroundColor:'#fff',logging:false,onclone:doc=>{
            // å¼·åˆ¶å¯è®€é»‘å­—
            doc.querySelectorAll('.item-content,.item-index,#week-display,#date-selector,.main-title,label,#weekno-input').forEach(el=>{
              el.style.color='#000'; if(el.id==='weekno-input'){ el.style.background='#fff'; el.style.border='1px solid #0002'; }
            });
            // ç§»é™¤è¼¸å…¥åˆ—
            doc.querySelector('#homework-input-area')?.remove();
          }});
          const a=document.createElement('a'); a.download=`${name}.png`; a.href=canvas.toDataURL('image/png'); document.body.appendChild(a); a.click(); a.remove();
        }catch(e){ alert('åŒ¯å‡ºåœ–ç‰‡å¤±æ•—ï¼š'+(e?.message||e)); }
        finally{ bar.style.display=prev || ''; }
      };
      $('#export-png-btn').onclick=()=>exportImage($('#main-card'),`è¯çµ¡ç°¿_${currentDate}`);
      $('#export-fullpng-btn').onclick=()=>exportImage($('.container'),`è¯çµ¡ç°¿æ•´é _${currentDate}`);

      /* --------- ç¯„æœ¬ Modal --------- */
      const initTemplateModal = () => {
        const modal = $('#template-modal');
        const showTemplateBtn = $('#show-template-btn');
        const categoryTabs = $('#category-tabs');
        const templatesGrid = $('#templates-grid');
        let inited = false;
        const show = () => modal.classList.add('visible');
        const hide = () => modal.classList.remove('visible');
        const renderCat = (cat) => {
          categoryTabs.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
          categoryTabs.querySelector(`.tab-btn[data-category="${cat}"]`)?.classList.add('active');
          templatesGrid.innerHTML='';
          (templates[cat]||[]).forEach(t=>{
            const btn=document.createElement('button');
            btn.className='template-item'; btn.textContent=t;
            btn.onclick=()=>{ add(t); hide(); };
            templatesGrid.appendChild(btn);
          });
        };
        showTemplateBtn.addEventListener('click', ()=>{
          if(!inited){
            Object.keys(templates).forEach(cat=>{
              const tab=document.createElement('button');
              tab.className='tab-btn'; tab.dataset.category=cat; tab.textContent=cat;
              tab.onclick=()=>renderCat(cat);
              categoryTabs.appendChild(tab);
            });
            renderCat(Object.keys(templates)[0]);
            inited=true;
          }
          show();
        });
        modal.addEventListener('click', e=>{ if(e.target===modal) hide(); });
        document.addEventListener('keydown', e=>{ if(e.key==='Escape') hide(); });
      };
      initTemplateModal();

      /* --------- å±•ç¤ºæ¨¡å¼åˆ‡æ›ï¼ˆè¿”å›ç·¨è¼¯ï¼‰ --------- */
      const enterPresentation = async ()=>{
        isPresentation=true;
        document.body.classList.add('presentation-mode');
        presentationBtn.textContent='è¿”å›ç·¨è¼¯';
        try{ await document.documentElement.requestFullscreen?.(); }catch(_){}
      };
      const exitPresentation = async ()=>{
        isPresentation=false;
        document.body.classList.remove('presentation-mode');
        presentationBtn.textContent='å…¨è¢å¹•å±•ç¤º';
        if (document.fullscreenElement) { try{ await document.exitFullscreen?.(); }catch(_){} }
      };
      presentationBtn.addEventListener('click', ()=>{
        if (!isPresentation) enterPresentation(); else exitPresentation();
      });
      document.addEventListener('fullscreenchange', ()=>{
        // ä½¿ç”¨è€…æŒ‰ ESC é›¢é–‹å…¨è¢å¹•æ™‚ï¼Œè‡ªå‹•å›åˆ°ç·¨è¼¯ç‹€æ…‹
        if (!document.fullscreenElement && isPresentation) {
          exitPresentation();
        }
      });
    });
  </script>
</body>
</html>
